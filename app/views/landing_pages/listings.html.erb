
<% if @offices.count == 0 %>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false&libraries=geometry,places&key=AIzaSyA63spoPlwAL-NcXhJaU7bOvJyZL2PuKQE">
    </script>
<% end %>





<div class="row padtopsmall padbottomsmall" style="margin-right: -20px; background-color: #ffffff;">

      <div class="span12">
        <% if @offices.count == 0 %>
            <div class="row search result">
              <div class="span12">
                <p>
                  Oops! We could not find any offices near your city. Try one of our popular locations -
                  <%= link_to "San Francisco", listings_path(:city => "San Francisco, CA") %> and
                  <%= link_to "San Jose", listings_path(:city => "San Jose, CA")  %>
                  <br /> <br />
                  Didn't find your city?  <%= link_to "Sign up for alerts", "#addAlert", :data => {:toggle=>"modal"} %>, and we'll let you know when a new space is posted in your city. 
                </p>
              </div>
            </div>

        <% else %>

            

          <!------------------ MAP VIEW ------------------------>
            <div class = "mapbar" id="mapview">
              
              <div class= "row">
                <%= gmaps("markers" => {"data" => @json},
                      "map_options" =>  { "provider" => "google",
                                  #       "client" => "gme-intuitinc",
                                  #       "channel" => "fms.spaces",
                                          "provider_key" => "AIzaSyA63spoPlwAL-NcXhJaU7bOvJyZL2PuKQE",
                                          "auto_zoom" => true,
                                          "libraries" => ["places"]
                      }
                    )
                %>
              </div>  
            
              
          </div>
           

            <!------------------ LIST VIEW ------------------------>

            <div class="resultsbar hide" id="listview">
                <div class="row">
                    <div class="sortmenu span3">
                      <ul class="nav" role="navigation">
                        <li class="dropdown">
                          <a id="sortdrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">
                            <strong>Sorted by:
                              <%if @sort=="rent" %>
                                  <%if @direction=="asc" %>
                                      Rent
                                  <% else %>
                                      Rent (High to Low)
                                  <% end %>
                              <% else %>
                                  <%if @search_string != "" %>
                                      Distance
                                  <% end %>
                              <% end %>
                            </strong>
                            <b class="caret"></b>
                          </a>
                          <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                            <li role="presentation">
                              <%= link_to "Rent", listings_path(:city => @search_string, :rentto => @rentto, :rentfrom => @rentfrom, :sort => "rent", :dir => "asc"), :role => "menuitem", :tabindex => "-1" %>
                            </li>

                            <!--li role="presentation">
                              <#%= link_to "Rent: High to Low", listings_path(:city => @search_string, :sort => "rent", :dir => "desc"), :role => "menuitem", :tabindex => "-1" %>
                            </li!-->

                            <% if @search_string != "" %>
                                <li role="presentation" class="divider"> </li>
                                <li role="presentation">
                                  <%= link_to "Distance", listings_path(:city => @search_string, :rentto => @rentto, :rentfrom => @rentfrom), :role => "menuitem", :tabindex => "-1" %>
                                </li>
                            <% end %>

                          </ul>
                        </li>
                      </ul>
                    </div>
                    
                </div>

                <!------------------ OFFICES VIEW ------------------------>
                    <% @offices.each do |office| %>
                      <div class="listing-container">
                       <div class="listing-header-container">
                         <div class="pull-left">
                            <% if office.user && office.user.photo? %>
                                <%= image_tag office.user.photo, class: "circle", size: '50x50' %>
                            <% else %>
                                <%= image_tag "default_person.png", class: "circle", size: '50x50' %>
                            <% end %>
                          </div>

                          <span class="listing-address">
                            <% if user_signed_in? %>
                              <%= link_to office.address, office %>
                            <% else %>  
                              <%= link_to office.loc_city + " , " + office.loc_state, office %>
                            <% end %>
                          </span>
                            <span class="listing-price">
                              <% if office.rent? %>
                                  <%= number_to_currency(office.rent, :locale => 'en_us', :precision => 0) %>
                                    <% if office.rent_type == 1 %>/month
                                    <% else %>
                                        <% if office.rent_type == 2 %>/week
                                        <% else %>
                                            <% if office.rent_type == 3 %>/day
                                            <% else %>/month
                                            <% end %>
                                        <% end %>
                                    <% end %>
                              <% else %>
                                Contact us
                              <% end %>
                            </span>
                          </span>
                        </div>

                      <div class="listing-body-container">
                        <div class="row-fluid">
                          <div class="span4">
                            <a href= "<%= office_path(office)  %>" >
                              <% if (office.office_images.first != nil) %>
                                  <%= cl_image_tag office.office_images.first.path, size: '186x140', :crop => :fill, :class => "img-polaroid"%>
                              <% else %>
                                  <%= image_tag "http://maps.googleapis.com/maps/api/streetview?size=186x140&location=#{office.latitude},%20#{office.longitude}&sensor=false&key=AIzaSyA63spoPlwAL-NcXhJaU7bOvJyZL2PuKQE", :crop => :fill, :class => "img-polaroid" %>
                              <% end %>
                            </a>
                          </div>
                          <div class="span5 office-summary">
                             <% if office.type_office==1 %><i class="icon-building orange"></i> private office/ desk &nbsp;<% end %>
                             <% if office.type_office==2 %><i class="icon-lightbulb orange"></i> design/ creative space &nbsp;<% end %>
                             <% if office.type_office==3 %><i class="icon-user-md orange"></i> counseling/ therapy office &nbsp;<% end %>
                             <% if office.type_office==4 %><i class="icon-male orange"></i> treatment/ bodywork room &nbsp;<% end %>
                          </div>
                          <div class="span3 pull-right text-right">
                              <% if office.min_lease? %><%= pluralize office.min_lease, 'month', 'months' %> min</br><% end %>
                              <% if office.size? %>
                                <div class="officeicon size"></div>
                                <%= office.size %> sq. ft
                            <% end %>
                          </div>
                          <div class="span8" style="margin-top:20px;">
                            <div class="row-fluid">
                            <div class="pull-left amenities-margin">
                              <p><% if office.wifi? %>
                                  <div class="officeicon wifi_on"></div>
                                  Wi-fi
                              <% else %>
                                  <div class="officeicon wifi_off"></div>
                                  <span class="text-gray"> Wi-fi</span>
                              <% end %>
                              </p>

                              <p><% if office.parking? %>
                                  <div class="officeicon park_on"></div>
                                  Parking
                              <% else %>
                                  <div class="officeicon park_off"></div>
                                  <span class="text-gray"> Parking</span>
                              <% end %>
                              </p>


                            </div>

                            <div class="pull-left amenities-margin">
                              <p><% if office.ac? %>
                                  <div class="officeicon ac_on"></div>
                                  Air Conditioning
                              <% else %>
                                  <div class="officeicon ac_off"></div>
                                  <span class="text-gray">Air Conditioning</span>
                              <% end %>
                              </p>

                              <p><% if office.confroom? %>
                                  <div class="officeicon conf_on"></div>
                                  Conference Room
                              <% else %>
                                  <div class="officeicon conf_off"></div>
                                  <span class="text-gray">Conference Room</span>
                              <% end %>
                              </p>

                            </div>

                            <div class="pull-left amenities-margin">
                              <p><% if office.printer? %>
                                  <div class="officeicon printer_on"></div>
                                  Printer
                              <% else %>
                                  <div class="officeicon printer_off"></div>
                                  <span class="text-gray">Printer</span>
                              <% end %>
                              </p>

                              <p><% if office.kitchen? %>
                                  <div class="officeicon kitchen_on"></div>
                                  Kitchen
                              <% else %>
                                  <div class="officeicon kitchen_off"></div>
                                  <span class="text-gray">Kitchen</span>
                              <% end %>
                              </p>

                            </div>

                            <div class="pull-left amenities-margin">
                                <p><% if office.window? %>
                                    <div class="officeicon window_on"></div>
                                    Window
                                <% else %>
                                    <div class="officeicon window_off"></div>
                                    <span class="text-gray">Window</span>
                                <% end %>
                                </p>
                            </div>
                          </div>
                          </div>
                        </div>
                      </div>
                 </div>

                  <% end %>


                <div class="pagemarker">
                  <div class="apple_pagination">
                  <%= will_paginate @offices, :container => false %>
                  </div>
                  <div class="listing_footer">Haven't found your perfect space? <%= link_to "Sign up for alerts", "#addAlert", :data => {:toggle=>"modal"} %>, and we'll let you know when a new space is posted in your city.</div>
                </div>

            </div>

            <!-------------------PHOTO VIEW ------------------------>

            <div class="resultsbar" id="photoview">
                <div class="row">
                  <ul class="thumbnails">
                  <% @offices.each do |office| %>

                          <li class="span4">
                            <div class="thumbnail">
                              <a href= "<%= office_path(office)  %>" >
                                <% if (office.office_images.first != nil) %>
                                    <%= cl_image_tag office.office_images.first.path, :size => '280x165', :crop => :fit, :class => "img-polaroid" %>
                                <% else %>

                                    <!--%= image_tag "http://maps.googleapis.com/maps/api/streetview?size=220x165&location=40.720032,%20-73.988354&fov=90&heading=235&pitch=10&sensor=false", :crop => :fit, :class => "img-polaroid" %-->
                                    <%= image_tag "http://maps.googleapis.com/maps/api/streetview?size=280x165&location=#{office.latitude},%20#{office.longitude}&sensor=false&key=AIzaSyA63spoPlwAL-NcXhJaU7bOvJyZL2PuKQE", :crop => :fit, :class => "img-polaroid" %>
                                <% end %>

                              </a>
                              <!-- img src="/assets/medium_default-studio.png" alt="" -->
                              <div class="media">
                                <% if office.user && office.user.photo? %>
                                    <img class="media-object pull-right" src="<%= office.user.photo %>" height="80px" width="80px">
                                <% else %>
                                    <img class="media-object pull-right" src="/assets/default_person.png" height="80px" width="80px">
                                <% end %>
                                <div class="media-body">
                                  <h4 class="media-heading"><%= number_to_currency(office.rent, :locale => 'en_us', :precision => 0) %> per month</h4>
                                  <p><%= pluralize(office.min_lease, 'Month') %> lease</p>
                                  <p><%= office.loc_city %></p>
                                </div>
                              </div>
                            </div>
                          </li>

                    <% end %>
                  </ul>
                </div>

                <div class="pagemarker span9">
                  <div class="apple_pagination">

                  <!--div class="page_info">
                    <#%= page_entries_info @offices %>
                  </div-->
                  <%= will_paginate @offices, :container => false %>
                  </div>
                  <div class="listing_footer">Haven't found your perfect space? <%= link_to "Sign up for alerts", "#addAlert", :data => {:toggle=>"modal"} %>, and we'll let you know when a new space is posted in your city.</div>
                </div>

            </div>


        <% end %>
      </div>

</div>


<%= render 'alerts/form' %>

<script type="text/javascript">

  $(document).ready (function() {
      searchAutocomplete();
      alertAutocomplete();
      iePlaceholderFix();
    });

    $( window ).load(function() {
        //alert( $.cookie("mapview") );

        
    });

    function showmapview() {
        $('#listview').hide();
        $('#mapview').attr('class', 'mapfull');
        Gmaps.loadMaps();

    }

    function showlistview() {
        $('#mapview').attr('class', 'mapbar');
        $('#listview').show();
        Gmaps.loadMaps();

    }

    $("#showMapBtn").click(function() {
        $.cookie ('mapview', 'true');
        showmapview();
        mixpanel.track("Clicked MapView button");
    });

    $("#showListBtn").click(function() {
        $.cookie ('mapview', 'false');
        showlistview();
        mixpanel.track("Clicked ListView button");

    });

    $("#searchBtn").click(function() {
        var val = $("#city").val();
        _gaq.push(['_trackEvent', "Search".concat(val), 'User clicks on Search']);
        mixpanel.track("Clicked Search", {location: val});
    });

    $("#search").keyup(function(event){
        if(event.keyCode == 13){
            $("#searchBtn").click();
        }
    });

</script>
