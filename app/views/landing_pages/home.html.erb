<!--script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry,places"></script-->

<script type="text/javascript"
        src="http://maps.google.com/maps/api/js?v=3&sensor=false&libraries=geometry,places&key=AIzaSyA63spoPlwAL-NcXhJaU7bOvJyZL2PuKQE">
</script>

<!--script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false&libraries=geometry,places&client=gme-intuitinc&channel=fms.spaces">
</script-->

<%= render 'landing_pages/search' %>

<div class="features paperpanel">
  <div class="container-fluid">
    <div class = "row-fluid">

      <%= render 'landing_pages/carousel' %>

      <hr>

      <%= render 'landing_pages/video' %>       
  
      <%= render 'landing_pages/alerts' %>

     </div>


  </div>   <!-- white features panel -->

  <%= render 'landing_pages/footer' %>

</div>

<script type="text/javascript">

$(document).ready (function() {
    var input = document.getElementById('city');
    var autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.setTypes(['geocode']);
    autocomplete.setComponentRestrictions({'country':'us'});
    google.maps.event.addListener(autocomplete, 'place_changed', function() {

        //$("#search input[type='submit']").click();
        $("#searchBtn").click();
    });

    alertAutocomplete();
});

function alertAutocomplete() {
  var inputA = document.getElementById('alertCity');
  var autocompleteA = new google.maps.places.Autocomplete(inputA);
  autocompleteA.setTypes(['geocode']);
  autocompleteA.setComponentRestrictions({'country':'us'});

  google.maps.event.addListener(autocompleteA, 'place_changed', function() {
    var place = autocompleteA.getPlace();
    console.log("Event::Place_Changed::" +place);
    if (place.address_components) {
      var city = document.getElementById('alert_loc_city');
      var state = document.getElementById('alert_loc_state');

      for (var i=0; i<place.address_components.length;i++)
      {
        for (var j=0;j<place.address_components[i].types.length;j++)
        {
          console.log('type:' + place.address_components[i].types[j] + ' => short_name:' + place.address_components[i].short_name + ' , long_name:' + place.address_components[i].long_name);
          if (place.address_components[i].types[j] == "locality")
          {
              city.value = place.address_components[i].long_name;
          }
          else if (place.address_components[i].types[j] == "administrative_area_level_1")
          {
              state.value = place.address_components[i].short_name;
          }
        }
      }
    }

    if (city.value == '') {
        alert("Please enter a valid address or city.");
    }
  });
}

$("#searchBtn").click(function() {
    var val = $("#city").val();
    _gaq.push(['_trackEvent', "Search".concat(val), 'User clicks on Search']);
    mixpanel.track("Clicked Search", {location: val});
});

$("#search").keyup(function(event){
    if(event.keyCode == 13){
        $("#searchBtn").click();
    }
});

</script>
